<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сочные билеты из Тель-Авива</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* ... (предыдущие стили остаются без изменений) ... */
    </style>
</head>
<body>
    <h1>Дешевые билеты из Тель-Авива</h1>
    <div id="buttons">
        <button class="search-button" onclick="searchFlights('tomorrow')"><span>Tomorrow</span></button>
        <button class="search-button" onclick="searchFlights('weekend')"><span>Weekend</span></button>
        <button class="search-button" onclick="searchFlights('vacation')"><span>Short Vacation</span></button>
    </div>
    <div id="quote"></div>
    <div id="flights">Выберите тип поиска</div>

    <script>
        const API_KEY = 'HymeBoRxtoITn816qE08K5ZrKptUIahu';
        const BASE_URL = 'https://api.tequila.kiwi.com/v2/search';

        // ... (предыдущие функции остаются без изменений) ...

        async function searchFlights(type) {
            const dates = getDateRange(type);
            const flightsDiv = document.getElementById('flights');
            flightsDiv.innerHTML = '<div style="text-align: center; padding: 20px;">Загрузка...</div>';
            document.getElementById('quote').textContent = getRandomQuote();

            const button = event.target;
            button.classList.add('active');

            try {
                const response = await axios.get(BASE_URL, {
                    headers: { 'apikey': API_KEY },
                    params: {
                        fly_from: 'TLV',
                        date_from: dates.from,
                        date_to: dates.to,
                        return_from: type !== 'tomorrow' ? dates.from : '',
                        return_to: type !== 'tomorrow' ? dates.to : '',
                        nights_in_dst_from: type === 'vacation' ? 3 : (type === 'weekend' ? 2 : ''),
                        nights_in_dst_to: type === 'vacation' ? 4 : (type === 'weekend' ? 2 : ''),
                        flight_type: type === 'tomorrow' ? 'oneway' : 'round',
                        max_stopovers: 2,
                        curr: 'USD',
                        sort: 'price',
                        limit: 10,
                        partner_market: 'il',
                        one_for_city: 1,
                    }
                });

                setTimeout(() => {
                    displayFlights(response.data.data, type);
                    button.classList.remove('active');
                }, 2000);
            } catch (error) {
                flightsDiv.innerHTML = 'Произошла ошибка при загрузке рейсов.';
                button.classList.remove('active');
            }
        }

        function displayFlights(flights, type) {
            const flightsDiv = document.getElementById('flights');
            if (flights.length === 0) {
                flightsDiv.innerHTML = 'Рейсы не найдены.';
                return;
            }

            let html = '<ul>';
            flights.forEach((flight, index) => {
                const departureRoute = flight.route.find(r => r.flyFrom === 'TLV');
                const returnRoute = type !== 'tomorrow' ? flight.route.find(r => r.flyTo === 'TLV') : null;

                const departureDate = new Date(departureRoute.local_departure);
                const returnDate = returnRoute ? new Date(returnRoute.local_departure) : null;

                html += `
                    <li style="animation-delay: ${index * 0.1}s;">
                        <div class="flight-details">
                            <div class="flight-info">
                                <strong>${flight.cityTo}</strong> (${flight.flyTo})<br>
                                Вылет: ${departureDate.toLocaleString()}<br>
                                ${returnDate ? `Обратно: из ${returnRoute.cityFrom} (${returnRoute.flyFrom})<br>
                                                ${returnDate.toLocaleString()}<br>` : ''}
                                Пересадки: ${Math.floor((flight.route.length - 1) / 2)}
                            </div>
                            <div class="flight-price">
                                $${flight.price}
                            </div>
                        </div>
                        <a href="${flight.deep_link}" target="_blank" class="buy-button">Купить билет</a>
                    </li>`;
            });
            html += '</ul>';
            flightsDiv.innerHTML = html;
        }
    </script>
</body>
</html>
